<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script language="javascript" type="text/javascript" src="../js/p5/empty-example/libraries/p5.js"></script>
    <script language="javascript" type="text/javascript" src="../js/p5/empty-example/libraries/p5.dom.js"></script>
    <script language="javascript" type="text/javascript" src="../js/p5/empty-example/libraries/p5.sound.js"></script>

    <!-- this line removes any default padding and style. you might only need one of these values set. -->
    <link rel="stylesheet" type="text/css" href="../assets/css/memory.css">

</head>
<body>
<div id="mainDiv">
</div>
<script>

    function Grid(rows, cols, colorSize, colours) {
        this.rows = rows;
        this.cols = cols;
        this.colorSize = colorSize;
        this.coloured = [];
        this.colours = colours;
    }

    Grid.prototype.changeColor = function() {

        function generateRowAndCol() {
            var fieldNumber = parseInt(random(0, this.rows * this.cols), 10);
            var row = parseInt(fieldNumber / this.cols, 10);
            var col = fieldNumber % this.cols;
            return {row: row, col: col};
        }

        for(var i = 0; i < this.colorSize; i++) {
            var __ret = generateRowAndCol.call(this);
            var row = __ret.row;
            var col = __ret.col;
            var exists = false;
            for(var j = this.coloured.length - 1; j >= 0; j--) {
                if(col === this.coloured[j].col && row === this.coloured[j].row) {
                    exists = true;
                    break;
                }
            }
            if(!exists) {
                this.coloured[i] = {row: row, col: col};
            }
            else {
                i--; // Retry
            }
        }
    };

    Grid.prototype.display = function() {
        var elementWidth = (width - 1) / this.cols;
        var elementHeight = (height - 1) / this.rows;
        var grid = this;
        for (var x = 0; x < this.rows; x++) {
            for (var y = 0; y < this.cols; y++) {
                var colorFill = color(255);
                this.coloured.forEach(function(rowCol) {
                    if(rowCol.row === x && rowCol.col === y) {
                        colorFill = grid.randomColour();
                    }
                });
                fill(colorFill);
                noStroke();
                rect(elementWidth * x + 1, elementHeight * y + 1, elementWidth - 1, elementHeight-1);
            }
        }
    };

    Grid.prototype.randomColour = function() {
        const random2 = parseInt(random(0, this.colours.length), 10);
        return color(this.colours[random2]);
    };

    var grid;

    var createMemoryCanvas = function () {
        var canvas = createCanvas(window.innerWidth * 0.5, window.innerHeight * 0.5);
        canvas.parent("#mainDiv");
        return canvas;
    };

    function setup() {
        var canvas = createMemoryCanvas();
        noLoop();
        grid = new Grid(3, 3, 3, ["#ff0000", "#00ff00"]);
    }

    function draw() {
        background(0);
        grid.display();
        grid.changeColor();
        noLoop();
        setTimeout(function() { loop() }, 1000);
    }


</script>


</body>
</html>